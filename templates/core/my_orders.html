{% extends 'base.html' %}
{% load static %}

{% block title %}Mes commandes — E-commerce Flow{% endblock %}

{% block extra_css %}
<style>
.my-orders-page { max-width: 960px; margin: 2.5rem auto; padding: 0 1.25rem; }
.my-orders-page h1 { font-family: 'Syne', sans-serif; font-size: 2rem; margin-bottom: 1.5rem; }
.order-card { background: #fff; border: 1.5px solid #e2e8f0; border-radius: 14px; margin-bottom: 1.25rem; overflow: hidden; }
.order-card-header {
    display: flex; align-items: center; gap: 1rem;
    padding: .9rem 1.25rem; background: #f8fafc;
    border-bottom: 1px solid #e2e8f0; flex-wrap: wrap;
}
.order-id { font-weight: 700; font-size: .95rem; }
.order-shop { color: #64748b; font-size: .88rem; }
.order-date { color: #94a3b8; font-size: .82rem; margin-left: auto; }
.order-items { padding: 1rem 1.25rem; }
.order-item-row {
    display: flex; align-items: center; gap: 1rem;
    padding: .5rem 0; border-bottom: 1px solid #f1f5f9;
}
.order-item-row:last-child { border-bottom: none; }
.oi-thumb {
    width: 48px; height: 48px; border-radius: 8px;
    background: #f1f5f9; display: flex; align-items: center; justify-content: center;
    overflow: hidden; flex-shrink: 0;
}
.oi-thumb img { width: 100%; height: 100%; object-fit: cover; }
.oi-name { flex: 1; font-weight: 500; font-size: .9rem; }
.oi-qty { color: #64748b; font-size: .85rem; }
.oi-price { font-weight: 600; font-size: .95rem; }
.order-footer {
    display: flex; align-items: center; justify-content: space-between;
    padding: .75rem 1.25rem; background: #f8fafc;
    border-top: 1px solid #e2e8f0; gap: 1rem; flex-wrap: wrap;
}
.order-total { font-weight: 700; font-size: 1.05rem; }
.badge { display: inline-flex; align-items: center; gap: .25rem; padding: .25rem .65rem; border-radius: 999px; font-size: .78rem; font-weight: 600; }
.badge-warning { background: #fef9c3; color: #a16207; }
.badge-info    { background: #dbeafe; color: #1d4ed8; }
.badge-primary { background: #e0e7ff; color: #4338ca; }
.badge-success { background: #dcfce7; color: #166534; }
.badge-danger  { background: #fee2e2; color: #991b1b; }
.empty-state { text-align: center; padding: 4rem 2rem; color: #94a3b8; }
.empty-state i { font-size: 3.5rem; margin-bottom: 1rem; display: block; }
.empty-state h3 { color: #64748b; margin-bottom: .5rem; }
</style>
{% endblock %}

{% block content %}
<div class="my-orders-page">
    <h1><i class="fas fa-box-open" style="color:var(--primary, #2563eb);"></i> Mes commandes</h1>

    {% if orders %}
        {% for order in orders %}
        <div class="order-card">
            <div class="order-card-header">
                <span class="order-id">#{{ order.id }}</span>
                <span class="order-shop"><i class="fas fa-store"></i> {{ order.shop.name }}</span>
                <span class="badge
                    {% if order.status == 'pending' %}badge-warning
                    {% elif order.status == 'processing' %}badge-info
                    {% elif order.status == 'shipped' %}badge-primary
                    {% elif order.status == 'delivered' %}badge-success
                    {% else %}badge-danger{% endif %}">
                    {% if order.status == 'pending' %}<i class="fas fa-clock"></i>
                    {% elif order.status == 'processing' %}<i class="fas fa-cog"></i>
                    {% elif order.status == 'shipped' %}<i class="fas fa-truck"></i>
                    {% elif order.status == 'delivered' %}<i class="fas fa-check-circle"></i>
                    {% else %}<i class="fas fa-times-circle"></i>{% endif %}
                    {{ order.get_status_display }}
                </span>
                <span class="order-date">{{ order.created_at|date:"d M Y à H:i" }}</span>
            </div>

            <div class="order-items">
                {% for item in order.items.all %}
                <div class="order-item-row">
                    <div class="oi-thumb">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                        {% else %}
                        <i class="fas fa-box" style="color:#94a3b8;"></i>
                        {% endif %}
                    </div>
                    <span class="oi-name">{{ item.product.name }}</span>
                    <span class="oi-qty">× {{ item.quantity }}</span>
                    <span class="oi-price">{{ item.get_subtotal }} €</span>
                </div>
                {% endfor %}
            </div>

            <div class="order-footer">
                <span class="order-total">Total : {{ order.total }} €</span>
                <span style="color:#64748b; font-size:.85rem;">Livraison gratuite</span>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="empty-state">
        <i class="fas fa-box-open"></i>
        <h3>Aucune commande pour l'instant</h3>
        <p>Parcourez nos boutiques pour trouver ce qu'il vous faut.</p>
        <a href="{% url 'shop_list' %}" class="btn btn-primary" style="margin-top:1rem;">
            <i class="fas fa-store"></i> Voir les boutiques
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
