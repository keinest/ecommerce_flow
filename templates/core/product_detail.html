{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} — {{ product.shop.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}

{% block content %}
<div class="product-page">
    <nav class="breadcrumb">
        <a href="{% url 'home' %}"><i class="fas fa-home"></i> Accueil</a>
        <i class="fas fa-chevron-right sep"></i>
        <a href="{% url 'shop_list' %}">Boutiques</a>
        <i class="fas fa-chevron-right sep"></i>
        <a href="{% url 'shop_detail' product.shop.pk %}">{{ product.shop.name }}</a>
        <i class="fas fa-chevron-right sep"></i>
        <span style="color:var(--dark);">{{ product.name }}</span>
    </nav>

    <div class="product-grid">
        <div class="product-img-wrap">
            {% if product.image %}<img src="{{ product.image.url }}" alt="{{ product.name }}">{% else %}<div class="no-img"><i class="fas fa-box"></i></div>{% endif %}
        </div>

        <div class="product-info">
            <a href="{% url 'shop_detail' product.shop.pk %}" class="shop-link"><i class="fas fa-store"></i> {{ product.shop.name }}</a>
            <h1>{{ product.name }}</h1>

            <div class="product-meta">
                {% if product.category %}<span class="badge badge-primary">{{ product.category.name }}</span>{% endif %}
                {% if product.stock > 10 %}
                <span class="stock-pill in"><div class="sdot g"></div> En stock ({{ product.stock }})</span>
                {% elif product.stock > 0 %}
                <span class="stock-pill low"><div class="sdot a"></div> Stock limité ({{ product.stock }})</span>
                {% else %}
                <span class="stock-pill out"><div class="sdot r"></div> Rupture de stock</span>
                {% endif %}
            </div>

            <div class="product-price">{{ product.price }} €</div>
            <p class="product-desc">{{ product.description }}</p>

            <div>
                <div class="detail-row"><span class="key">Boutique</span><span class="val">{{ product.shop.name }}</span></div>
                <div class="detail-row"><span class="key">Catégorie</span><span class="val">{{ product.category.name|default:"Non catégorisé" }}</span></div>
                <div class="detail-row"><span class="key">Stock</span><span class="val">{{ product.stock }} unité{{ product.stock|pluralize }}</span></div>
                <div class="detail-row"><span class="key">Ajouté le</span><span class="val">{{ product.created_at|date:"d F Y" }}</span></div>
            </div>

            {% if product.stock > 0 %}
                {% if is_owner %}
                <div class="notice"><i class="fas fa-info-circle"></i><span>Vous êtes le propriétaire de ce produit. Vous ne pouvez pas commander vos propres articles.</span></div>
                {% elif user.is_authenticated %}
                <div class="product-actions">
                    <a href="{% url 'add_to_cart' product.pk %}" class="btn btn-primary"><i class="fas fa-cart-plus"></i> Ajouter au panier</a>
                    <a href="{% url 'cart_detail' %}" class="btn btn-secondary"><i class="fas fa-shopping-cart"></i> Voir le panier</a>
                </div>
                {% else %}
                <div class="notice"><i class="fas fa-lock"></i><span><a href="{% url 'login' %}">Connectez-vous</a> pour ajouter ce produit au panier.</span></div>
                {% endif %}
            {% else %}
            <div class="notice out-notice"><i class="fas fa-times-circle"></i> Ce produit est en rupture de stock.</div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
